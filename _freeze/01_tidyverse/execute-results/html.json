{
  "hash": "19067032da056ca772affc35a54fb382",
  "result": {
    "markdown": "---\ntitle: \"Tidyverse\"\nauthor: \"Foad Sanjaran\"\n---\n\n\n**Sales analysis: This  analyzes the sales by location (state) with a bar plot. **\n\nSome business insights for bike sellers is created in this section. Two analyses based on two important categories (year and state) have been made.\n\n\n# Code:\n\n\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-1_08297a6ca80bc8b7f1d80a90d6668be4'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(readr)\nlibrary(purrr)\n\n\nbikes_tbl      <- read_excel(path = \"00_data/01_raw_data/bikes.xlsx\")\norderlines_tbl <- read_excel(\"00_data/01_raw_data/orderlines.xlsx\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\n• `` -> `...1`\n```\n:::\n\n```{.r .cell-code}\nbikeshops_tbl  <- read_excel(\"00_data/01_raw_data/bikeshops.xlsx\")\n\n\n\nleft_join(orderlines_tbl, bikes_tbl, by = c(\"product.id\" = \"bike.id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 15,644 × 15\n   ...1  order.id order.line order.date          customer.id product.id quantity\n   <chr>    <dbl>      <dbl> <dttm>                    <dbl>      <dbl>    <dbl>\n 1 1            1          1 2015-01-07 00:00:00           2       2681        1\n 2 2            1          2 2015-01-07 00:00:00           2       2411        1\n 3 3            2          1 2015-01-10 00:00:00          10       2629        1\n 4 4            2          2 2015-01-10 00:00:00          10       2137        1\n 5 5            3          1 2015-01-10 00:00:00           6       2367        1\n 6 6            3          2 2015-01-10 00:00:00           6       1973        1\n 7 7            3          3 2015-01-10 00:00:00           6       2422        1\n 8 8            3          4 2015-01-10 00:00:00           6       2655        1\n 9 9            3          5 2015-01-10 00:00:00           6       2247        1\n10 10           4          1 2015-01-11 00:00:00          22       2408        1\n# ℹ 15,634 more rows\n# ℹ 8 more variables: model <chr>, model.year <dbl>, frame.material <chr>,\n#   weight <dbl>, price <dbl>, category <chr>, gender <chr>, url <chr>\n```\n:::\n\n```{.r .cell-code}\nbike_orderlines_joined_tbl <- orderlines_tbl %>%\n  left_join(bikes_tbl, by = c(\"product.id\" = \"bike.id\")) %>%\n  left_join(bikeshops_tbl, by = c(\"customer.id\" = \"bikeshop.id\"))\nbike_orderlines_wrangled_tbl <- bike_orderlines_joined_tbl %>%\n  separate(col    = location,\n           into   = c(\"city\", \"state\"),\n           sep    = \", \") %>%\n  \n  mutate(total.price = price * quantity) %>%\n  select(-...1, -gender) %>%\n  select(-ends_with(\".id\")) %>%\n  bind_cols(bike_orderlines_joined_tbl %>% select(order.id)) %>% \n  select(order.id, contains(\"order\"), contains(\"model\"), contains(\"location\"),\n         price, quantity, total.price,\n         everything()) %>%\n  rename(bikeshop = name) %>%\n  set_names(names(.) %>% str_replace_all(\"\\\\.\", \"_\"))\n\n\n\nsales_by_location_tbl <- bike_orderlines_wrangled_tbl %>%\n  select(state, total_price) %>%\n  mutate(location = str_to_title(str_replace_all(state, fixed(\"_\"), \" \"))) %>%\n  group_by(location) %>% \n  summarize(sales = sum(total_price)) %>%\n  \n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n\n\nsales_by_location_tbl %>%\n  ggplot(aes(x = location, y = sales)) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +\n  geom_col(fill = \"#6D8dD1\") + \n  geom_label(aes(label = sales_text)) + \n  geom_smooth(method = \"lm\", se = FALSE) + \n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \" €\")) +\n  labs(\n    title    = ,\n    subtitle = ,\n    x = \"\", \n    y = \"Revenue\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsales_by_location_year_tbl <- bike_orderlines_wrangled_tbl %>%\n  select(order_date, total_price, state) %>%\n  mutate(year = year(order_date)) %>%\n  group_by(year, state) %>%\n  summarise(sales = sum(total_price)) %>%\n  ungroup() %>%\n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nsales_by_location_year_tbl %>%\n  ggplot(aes(x = year, y = sales, fill = state)) +\n  geom_col() +\n  facet_wrap(~ state) +\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \" €\")) +\n  labs(\n    title = ,\n    subtitle = ,\n    fill = \"Main category\",\n  )\n```\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}